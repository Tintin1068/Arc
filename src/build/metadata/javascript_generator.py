#!/usr/bin/env python

# Copyright 2015 The Chromium Authors. All rights reserved.
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

import json
import sys

from metadata import manager

_TEMPLATE = '''// Copyright 2015 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.

// DO NOT EDIT
// This file is automatically generated by
// src/build/metadata/javascript_generator.py.

var METADATA = new Object();

/** @const */
METADATA.DEFAULT_VALUES = {0};

/** @const */
METADATA.ALLOWED_VALUES = {1};

/** @const */
METADATA.PLUGIN_FIELDS = {2};

/** @const */
METADATA.CHILD_PLUGIN_FIELDS = {3};
'''


def main():
  metadata_definitions = manager.get_metadata_definitions()

  default_values = {}
  allowed_values = {}
  plugin_fields = []
  child_plugin_fields = []

  for definition in metadata_definitions:
    if definition.external_only:
      continue
    default_values[definition.name] = definition.default_value
    if definition.allowed_values:
      allowed_values[definition.name] = definition.allowed_values
    if definition.plugin:
      plugin_fields.append(definition.name)
    if definition.child_plugin:
      child_plugin_fields.append(definition.name)

  sys.stdout.write(_TEMPLATE.format(json.dumps(default_values, indent=2),
                                    json.dumps(allowed_values, indent=2),
                                    json.dumps(plugin_fields, indent=2),
                                    json.dumps(child_plugin_fields, indent=2)))


if __name__ == '__main__':
  sys.exit(main())
